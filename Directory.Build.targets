<Project>
  <Choose>
    <When Condition="'$(ShouldAddWinUI)' == 'true' and '$(TargetFramework)' == 'netcoreapp5.0'">
      <PropertyGroup>
        <AssetTargetFallback>uap10.0.$(DefaultTargetPlatformMinVersion)</AssetTargetFallback>
      </PropertyGroup>
      <ItemGroup>
        <PackageReference Include="Microsoft.Windows.CsWinRT" Version="$(MicrosoftCsWinrtVersion)" />
        <!--<PackageReference Include="Microsoft.VCRTForwarders.140" Version="1.0.6" />-->
      </ItemGroup>
      <ItemGroup Condition="'$(IsUwpProject)' == 'true' or '$(IsDesignProject)' == 'true' or '$(IsSampleProject)' == 'true' or '$(IsTestProject)' == 'true'">
        <PackageReference Include="Microsoft.WinUI" Version="$(MicrosoftWinUIVersion)"/>
      </ItemGroup>
      <ItemGroup>
        <None Include="$(OutputPath)\$(AssemblyName)\**\*.xaml;$(OutputPath)\$(AssemblyName)\**\*.xbf">
          <Pack>true</Pack>
          <PackagePath>lib\$(TargetFramework)\$(AssemblyName)</PackagePath>
        </None>
      </ItemGroup>
      <ItemGroup Condition="Exists('$(OutputPath)\$(AssemblyName)\$(AssemblyName).xr.xml')">
        <Resource Include="$(OutputPath)\$(AssemblyName)\$(AssemblyName).xr.xml">
          <Pack>true</Pack>
          <PackagePath>lib\$(TargetFramework)\$(AssemblyName)\$(AssemblyName).xr.xml</PackagePath>
        </Resource>
      </ItemGroup>
      <ItemGroup Condition="Exists('$(OutputPath)\$(AssemblyName).pri')">
        <None Include="$(SolutionDir)\build\CopyPri.targets" Pack="True" PackagePath="buildTransitive\netcoreapp5.0\$(AssemblyName).targets" />
      </ItemGroup>
      <PropertyGroup Condition="'$(Configuration)' == 'Release'">
        <!--<TreatWarningsAsErrors>true</TreatWarningsAsErrors>-->
      </PropertyGroup>
    </When>
  </Choose>

  <PropertyGroup Condition="'$(DebugType)' == ''">
    <DebugType>Portable</DebugType>
  </PropertyGroup>
  
  <Choose>
    <!-- Small fix for wrong TFM in final nuget -->
    <When Condition="'$(TargetFramework)' == 'netcoreapp5.0'">
      <ItemGroup Condition="Exists('$(OutputPath)\$(AssemblyName).pri')">
        <None Include="$(OutputPath)\$(AssemblyName).pri" Pack="True" PackagePath="lib\netcoreapp5.0\"/>
      </ItemGroup>
      <ItemGroup>
        <None Include="$(OutputPath)\$(AssemblyName).dll;$(OutputPath)\$(AssemblyName).xml;$(OutputPath)\$(AssemblyName).pdb" Pack="True" PackagePath="lib\netcoreapp5.0\"/>
      </ItemGroup>
      <PropertyGroup>
        <IncludeBuildOutput>false</IncludeBuildOutput>
      </PropertyGroup>
    </When>
  </Choose>
  
  <Choose>
    <When Condition="$(TargetFramework.Contains('uap10.0')) == false and '$(TargetFramework)' != 'native' and '$(IsTestSampleProject)' != 'true'">
      <PropertyGroup>
        <SignAssembly>true</SignAssembly>
        <AssemblyOriginatorKeyFile>$(MSBuildThisFileDirectory)toolkit.snk</AssemblyOriginatorKeyFile>
      </PropertyGroup>
    </When>
  </Choose>

  <Target Name="AddCommitHashToAssemblyAttributes" BeforeTargets="GetAssemblyAttributes">
    <ItemGroup>
      <AssemblyAttribute Include="System.Reflection.AssemblyMetadataAttribute" Condition=" '$(SourceRevisionId)' != '' ">
        <_Parameter1>CommitHash</_Parameter1>
        <_Parameter2>$(SourceRevisionId)</_Parameter2>
      </AssemblyAttribute>
    </ItemGroup>
  </Target>
</Project>